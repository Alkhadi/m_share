<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>M Share • Send/Receive Money</title>
  <meta name="description" content="Copy details, then open your banking app.">
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<header class="site-header">
  <div class="container navbar">
    <a class="brand" href="index.html"><span class="logo">M</span> M Share</a>
    <nav class="main-nav" id="mainNav">
      <a data-href="index.html">Profile</a>
      <a data-href="bank.html">Money</a>
      <a data-href="wellbeing.html">Wellbeing</a>
      <a data-href="pdf.html">PDF</a>
      <button id="shareOpen" class="btn" type="button"><span class="icon">🔗</span> Share</button>
    </nav>
    <button id="navToggle" class="nav-toggle" aria-label="Menu">☰</button>
  </div>
</header>

<main class="container">
  <div class="card">
    <h1>Send money to <span id="name">Alkhadi</span>?</h1>
    <div class="muted">Tap <b>Copy details</b> then choose your bank app.</div>

    <div class="kv-grid" style="margin-top: 12px;">
      <div class="kv"><div class="muted">Account name</div><div id="accName" style="font-weight:600">Alkhadi Koroma</div></div>
      <div class="kv"><div class="muted">Reference</div><div id="ref" style="font-weight:600">M SHARE</div></div>
      <div class="kv"><div class="muted">Account number</div><div id="acc" style="font-weight:600">—</div></div>
      <div class="kv"><div class="muted">Sort code</div><div id="sort" style="font-weight:600">—</div></div>
      <div class="kv"><div class="muted">IBAN</div><div id="iban" style="font-weight:600">—</div></div>
    </div>

    <div>
      <button class="btn" id="copyBtn">Copy details</button>
      <span id="copied" class="muted"></span>
    </div>

    <div class="muted" style="margin-top:10px">Open your bank app:</div>
    <div class="apps">
      <a class="app-btn" data-scheme="monzo://"    data-name="Monzo">Monzo</a>
      <a class="app-btn" data-scheme="starling://"  data-name="Starling">Starling</a>
      <a class="app-btn" data-scheme="revolut://"   data-name="Revolut">Revolut</a>
      <a class="app-btn" data-scheme="barclaysmobilebanking://" data-name="Barclays">Barclays</a>
      <a class="app-btn" data-scheme="natwest://"   data-name="NatWest">NatWest</a>
      <a class="app-btn" data-scheme="hsbcukmobilebanking://" data-name="HSBC UK">HSBC UK</a>
      <a class="app-btn" data-scheme="santanderuk://" data-name="Santander">Santander</a>
      <a class="app-btn" data-scheme="lloydsbank://" data-name="Lloyds">Lloyds</a>
      <a class="app-btn" data-scheme="halifax://"   data-name="Halifax">Halifax</a>
      <a class="app-btn" data-scheme="tsb://"       data-name="TSB">TSB</a>
    </div>

    <div style="margin-top:16px; display:flex; gap:8px; flex-wrap:wrap">
      <a id="back" class="btn">← Back to profile</a>
      <button id="shareOpen2" class="btn">🔗 Share</button>
    </div>
  </div>
</main>

<!-- Share sheet -->
<div id="shareSheet" class="sheet hidden">
  <div id="shareBackdrop" class="sheet" style="position:absolute; inset:0;"></div>
  <div class="sheet-card" role="dialog" aria-modal="true" aria-labelledby="shareTitle">
    <div class="sheet-head">
      <h2 id="shareTitle" class="sheet-title">Share profile</h2>
      <button id="shareClose" class="sheet-close" aria-label="Close">×</button>
    </div>
    <textarea id="shareText" class="share-text" readonly></textarea>
    <div class="share-actions">
      <button class="btn" id="copyShare">📋 Copy</button>
      <button class="btn" id="shareNative">🔗 Share…</button>
      <button class="btn" id="savePng">🖼️ Save PNG</button>
      <button class="btn" id="sharePng">📤 Share PNG</button>
      <button class="btn" id="shareWA">🟢 WhatsApp</button>
      <button class="btn" id="shareSMS">💬 SMS</button>
      <button class="btn" id="shareMAIL">✉️ Email</button>
    </div>
  </div>
</div>

<script src="app.js"></script>
<script>
  const { data, qp } = window.__MSHARE__;
  // Back link preserves current query
  document.getElementById('back').href = 'index.html' + (qp || '');

  const name = data.name;
  const accVal = data.acc || '';
  const sortVal = data.sort || '';
  const ibanVal = data.iban || '';
  const refVal = data.ref || 'M SHARE';

  accName.textContent = name;
  document.getElementById('name').textContent = name;
  document.getElementById('acc').textContent  = accVal || '—';
  document.getElementById('sort').textContent = sortVal || '—';
  document.getElementById('iban').textContent = ibanVal || '—';
  document.getElementById('ref').textContent  = refVal || '—';

  const details = `Payee: ${name}
Account: ${accVal}
Sort code: ${sortVal}
IBAN: ${ibanVal}
Reference: ${refVal}`;

  copyBtn.addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText(details);
      copied.textContent = 'Copied. Now open your bank app below.';
      copied.className = 'ok';
    } catch {
      copied.textContent = 'Copy failed. Long-press to copy:';
      copied.className = 'err';
      const pre = document.createElement('pre');
      pre.textContent = details;
      copyBtn.insertAdjacentElement('afterend', pre);
    }
  });

  function isAndroid() { return /Android/i.test(navigator.userAgent); }
  function isIOS()     { return /iPhone|iPad|iPod/i.test(navigator.userAgent); }

  function openApp(scheme, label) {
    const t = Date.now();
    location.href = scheme;
    setTimeout(() => {
      if (Date.now() - t < 1600) {
        const q = encodeURIComponent(label + ' bank');
        location.href = isAndroid()
          ? 'https://play.google.com/store/search?q=' + q + '&c=apps'
          : 'https://apps.apple.com/gb/search?term=' + q;
      }
    }, 1000);
  }

  document.querySelectorAll('.apps .app-btn').forEach(b => {
    b.addEventListener('click', () => {
      navigator.clipboard.writeText(details).catch(() => {});
      openApp(b.dataset.scheme, b.dataset.name);
    });
  });

  // Share button on page
  document.getElementById('shareOpen2').addEventListener('click', () => {
    document.getElementById('shareOpen').click();
  });
</script>
</body>
</html>